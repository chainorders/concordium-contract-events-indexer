import {
    BaseAccountTransactionSummary,
    ContractAddress,
    InitContractSummary,
} from '@concordium/node-sdk';

/**
 * Should the listener listen to a particular block?
 * @param blockHash Block Hash
 */
export const shouldProcessBlock = (blockHash: string): boolean => {
    console.log(`filters: Will process block: ${blockHash}`);
    return true;
};

/**
 * Should the listener listen to a particular transaction?
 * @param txnHash Transaction Hash
 */
export const shouldProcessAccountTransaction = (txnHash: string): boolean => {
    console.debug(`filters: Will process transaction:${txnHash}`);
    return true;
};

/**
 * Should process a particular module?
 * @param txn Init Contract Transaction.
 * @returns
 */
export const shouldProcessInitContractTransaction = (
    txn: BaseAccountTransactionSummary & InitContractSummary
): boolean => {
    console.debug(
        `filters: Will process module:${txn.contractInitialized.ref}`
    );

    return true;
};

/**
 * Should process Contract Address. This does not apply to Contract Init Events.
 * @param address Contract Address
 */
export const shouldProcessContract = (address?: ContractAddress): boolean => {
    console.debug(
        `filters: Will process contract: ${address?.index}/${address?.subindex}`
    );

    return !!address;
};

/**
 * Smart Contract Modules and there schema to which the listener will listen to.
 */
export const contractModules: { [ref: string]: { moduleSchema: string } } = {
    // CIS2 Multi
    '83b372c9ef9c5053746a3edefaeea96e45757dd6936f50650dac63dbcdf9505f': {
        moduleSchema:
            'FFFF03010000000A000000434953322D4D756C7469000A0000000900000062616C616E63654F6606100114000200000008000000746F6B656E5F69641D0007000000616464726573731502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C10011B2500000015040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E74656402040000006D696E7404140002000000050000006F776E65721502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C06000000746F6B656E7312021D000F1400020000000300000075726C1601040000006861736816011B2500000015040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E746564020F0000006F6E526563656976696E67434953320315040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E746564020A0000006F70657261746F724F66061001140002000000050000006F776E65721502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C07000000616464726573731502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C10010115040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E746564020F000000736574496D706C656D656E746F72730414000200000002000000696416000C000000696D706C656D656E746F727310020C15040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E7465640208000000737570706F727473061001160010011503000000090000004E6F537570706F72740207000000537570706F72740209000000537570706F72744279010100000010000C15040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E746564020D000000746F6B656E4D657461646174610610011D0010011400020000000300000075726C160104000000686173681502000000040000004E6F6E650204000000536F6D65010100000013200000000215040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E74656402080000007472616E7366657204100114000500000008000000746F6B656E5F69641D0006000000616D6F756E741B250000000400000066726F6D1502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C02000000746F1502000000070000004163636F756E7401010000000B08000000436F6E747261637401020000000C160104000000646174611D0115040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E746564020E0000007570646174654F70657261746F720410011400020000000600000075706461746515020000000600000052656D6F7665020300000041646402080000006F70657261746F721502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C15040000000E000000496E76616C6964546F6B656E49640211000000496E73756666696369656E7446756E6473020C000000556E617574686F72697A65640206000000437573746F6D010100000015070000000B0000005061727365506172616D7302070000004C6F6746756C6C020C0000004C6F674D616C666F726D65640213000000496E76616C6964436F6E74726163744E616D65020C000000436F6E74726163744F6E6C790213000000496E766F6B65436F6E74726163744572726F720212000000546F6B656E416C72656164794D696E7465640204000000766965770114000200000005000000737461746510020F1502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C1400020000000800000062616C616E63657310020F1D001B25000000090000006F70657261746F727310021502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C06000000746F6B656E7310021D00011F05000000FB0D000000546F6B656E4D65746164617461000200000008000000746F6B656E5F69641D000C0000006D657461646174615F75726C1400020000000300000075726C160104000000686173681502000000040000004E6F6E650204000000536F6D650101000000132000000002FC0E0000005570646174654F70657261746F7200030000000600000075706461746515020000000600000052656D6F7665020300000041646402050000006F776E65721502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C080000006F70657261746F721502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000CFD040000004275726E000300000008000000746F6B656E5F69641D0006000000616D6F756E741B25000000050000006F776E65721502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000CFE040000004D696E74000300000008000000746F6B656E5F69641D0006000000616D6F756E741B25000000050000006F776E65721502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000CFF080000005472616E73666572000400000008000000746F6B656E5F69641D0006000000616D6F756E741B250000000400000066726F6D1502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C02000000746F1502000000070000004163636F756E7401010000000B08000000436F6E747261637401010000000C',
    },
    // CIS2 Market
    '247a7ac6efd2e46f72fd18741a6d1a0254ec14f95639df37079a576b2033873e': {
        moduleSchema:
            'FFFF03010000000A0000004D61726B65742D4E465401001400010000000A000000636F6D6D697373696F6E03030000000300000061646400140005000000140000006E66745F636F6E74726163745F616464726573730C08000000746F6B656E5F69641D000500000070726963650A07000000726F79616C747903080000007175616E746974791B25000000040000006C69737401140101000000100114000700000008000000746F6B656E5F69641D0008000000636F6E74726163740C0500000070726963650A050000006F776E65720B07000000726F79616C7479030D0000007072696D6172795F6F776E65720B080000007175616E746974791B25000000080000007472616E7366657200140005000000140000006E66745F636F6E74726163745F616464726573730C08000000746F6B656E5F69641D0002000000746F0B050000006F776E65720B080000007175616E746974791B250000000115010000000F0000005175616E7469747955706461746564010100000014000700000008000000746F6B656E5F69641D0008000000636F6E74726163740C0500000070726963650A050000006F776E65720B07000000726F79616C7479030D0000007072696D6172795F6F776E65720B080000007175616E746974791B25000000',
    },
};

/**
 * Converts the parsed event to database event.
 * This method is specially needed to convert some of the datatypes which are supported by database.
 * For Example. The Token Amount is serialized as string when parsing the event.
 * In order to perform aggregation over events the amount needs to persisted as a numeric type.
 * @param event Node event parsed from serialized JSON.
 * @returns object thats directly persisted to the database.
 */
export const toDbEvent = (event: Record<string, any>): Record<string, any> => {
    const key = Object.keys(event)[0];

    switch (key) {
        case 'Mint':
            return {
                ...event,
                Mint: {
                    ...event.Mint,
                    amount: parseInt(event.Mint.amount),
                },
            };
        case 'Transfer':
            return {
                ...event,
                Transfer: {
                    ...event.Transfer,
                    amount: parseInt(event.Transfer.amount),
                },
            };
        case 'Burn':
            return {
                ...event,
                Burn: {
                    ...event.Burn,
                    amount: parseInt(event.Burn.amount),
                },
            };
        case 'UpdateOperator':
        case 'TokenMetadata':
        default:
            return event;
    }
};
